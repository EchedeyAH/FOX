name: Deploy to ECU

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: self-hosted

    # ðŸ”§ Necesario para evitar fallos con Node 20 en Ubuntu 18.04 (glibc 2.27)
    env:
      ACTIONS_ALLOW_USE_UNSECURE_NODE_VERSION: true

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Mostrar informaciÃ³n del runner
        run: |
          echo "Runner ejecutÃ¡ndose como usuario: $(whoami)"
          echo "Directorio actual: $(pwd)"
          echo "Contenido del workspace:"
          ls -la

      - name: Ejecutar script de despliegue en la ECU
        run: |
          echo "ðŸš€ Ejecutando el script de despliegue en la ECU..."
          bash "/home/$(whoami)/CI-CD/deploy_ecu.sh"

      - name: ConfirmaciÃ³n final
        run: echo "ðŸŽ‰ Despliegue completado correctamente."
